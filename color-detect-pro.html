<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TrueShade Pro — Live Color Detector</title>
<style>
:root{
  --bg1:#071029; --bg2:#0f1724;
  --glass: rgba(255,255,255,0.03);
  --muted: rgba(255,255,255,0.7);
  --primary:#7c3aed;
  --radius:14px;
  --ui-font: Inter, system-ui, "Segoe UI", Roboto, Arial;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:var(--ui-font);background:linear-gradient(180deg,var(--bg2),var(--bg1));color:#eef2ff;display:flex;align-items:center;justify-content:center;padding:12px}
.app{width:960px;max-width:96vw;border-radius:18px;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 18px 50px rgba(2,6,23,0.7);border:1px solid rgba(255,255,255,0.02)}
.top{display:flex;align-items:center;gap:12px;margin-bottom:14px}
.logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,#7c3aed,#4f46e5);display:flex;align-items:center;justify-content:center;font-weight:800;color:white}
.title{font-size:18px;font-weight:800}
.subtitle{font-size:12px;color:var(--muted)}
.main{display:grid;grid-template-columns:1fr 340px;gap:14px}
.stage{background:#000;border-radius:14px;min-height:620px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
.controls-bar{display:flex;gap:8px;align-items:center;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-bottom:1px solid rgba(255,255,255,0.02)}
.btn{padding:10px 12px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.02);color:#eef2ff;font-weight:700;cursor:pointer;display:inline-flex;gap:8px;align-items:center}
.btn.primary{background:linear-gradient(90deg,#7c3aed,#4f46e5);box-shadow:0 8px 24px rgba(79,70,229,0.12)}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
.stage-body{position:relative;height:520px;display:flex;align-items:center;justify-content:center}
video,.preview-img,canvas{max-width:100%;width:100%;height:100%;object-fit:cover;display:block}
.preview-img{display:block;width:100%;height:100%;object-fit:contain;background:#0b0b0b}
.center-cross{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:84px;height:84px;border-radius:18px;border:2px dashed rgba(255,255,255,0.6);display:flex;align-items:center;justify-content:center;z-index:25;pointer-events:none}
.center-dot{width:12px;height:12px;border-radius:50%;background:rgba(255,255,255,0.95);box-shadow:0 2px 8px rgba(0,0,0,0.6)}
.floating-chip{position:absolute;left:50%;transform:translateX(-50%);bottom:78px;background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015));padding:10px 14px;border-radius:999px;display:flex;align-items:center;gap:12px;border:1px solid rgba(255,255,255,0.02);backdrop-filter: blur(6px);z-index:30;transition:opacity .15s,transform .15s}
.floating-chip.hidden{opacity:0;transform:translateX(-50%) translateY(8px);pointer-events:none}
.swatch{width:28px;height:28px;border-radius:8px;border:1px solid rgba(0,0,0,0.2);box-shadow:0 6px 18px rgba(0,0,0,0.5)}
.magnifier{position:absolute;width:120px;height:120px;border-radius:12px;border:2px solid rgba(255,255,255,0.06);overflow:hidden;z-index:40;display:none;background:#000;box-shadow:0 8px 30px rgba(2,6,23,0.6);}
.magnifier canvas{width:100%;height:100%;display:block;transform-origin:center}
.panel{padding:12px;display:flex;flex-direction:column;gap:12px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
.big-color{display:flex;gap:12px;align-items:center}
.big-swatch{width:72px;height:72px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
.big-meta{flex:1}
.color-name{font-weight:900;font-size:18px}
.color-sub{font-size:13px;color:var(--muted);margin-top:6px}
.meta-row{display:flex;gap:8px;align-items:center;margin-top:10px}
.hex{font-weight:900;background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:8px}
.copy-small{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.03);cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
.history-list{display:flex;flex-direction:column;gap:8px;max-height:300px;overflow:auto;padding-right:6px}
.history-item{display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;background:rgba(0,0,0,0.16);cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
.hist-swatch{width:48px;height:48px;border-radius:8px;flex-shrink:0}
.hist-meta{flex:1}
.hist-name{font-weight:800}
.hist-sub{font-size:12px;color:var(--muted)}
.footer-note{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}
@media(max-width:920px){
  .main{grid-template-columns:1fr;gap:12px}
  .stage{order:2}
  .panel{order:1}
}
</style>
</head>
<body>
<div class="app">
  <div class="top">
    <div class="logo">TS</div>
    <div>
      <div class="title">TrueShade Pro</div>
      <div class="subtitle">Live camera + Upload — precise color picking</div>
    </div>
  </div>

  <div class="main">
    <div class="stage">
      <div class="controls-bar">
        <button class="btn primary" id="startStopBtn">Start Camera</button>
        <button class="btn" id="detectNowBtn">Detect Now</button>
        <label class="btn ghost" for="uploadInput">Upload Image
          <input id="uploadInput" type="file" accept="image/*" />
        </label>
        <div style="margin-left:auto;display:flex;gap:6px;align-items:center">
          <label><input id="continuousToggle" type="checkbox"> Continuous</label>
        </div>
      </div>

      <div class="stage-body" id="stageBody">
        <video id="video" autoplay playsinline style="display:none"></video>
        <img id="previewImg" class="preview-img" style="display:none"/>
        <canvas id="buffer" style="display:none"></canvas>
        <div class="center-cross"><div class="center-dot"></div></div>
        <div class="floating-chip hidden" id="floatingChip">
          <div class="swatch" id="chipSwatch"></div>
          <div>
            <div id="chipName"></div>
            <div style="font-size:13px;color:var(--muted)" id="chipMeta"></div>
          </div>
        </div>
        <div class="magnifier" id="magnifier"><canvas id="magnCanvas"></canvas></div>
      </div>
    </div>

    <div class="panel">
      <div class="card big-color">
        <div class="big-swatch" id="bigSwatch"></div>
        <div class="big-meta">
          <div class="color-name" id="colorName"></div>
          <div class="color-sub" id="colorSub"></div>
          <div class="meta-row">
            <div class="hex" id="hexLabel"></div>
            <button class="copy-small" id="copyHex">Copy HEX</button>
            <button class="copy-small" id="exportHistory">Export</button>
            <button class="copy-small" id="clearHistory">Clear</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="font-weight:800">History</div>
          <div style="font-size:13px;color:var(--muted)">Tap to reuse</div>
        </div>
        <div class="history-list" id="historyList"></div>
      </div>

      <div class="card" style="text-align:center">
        <div style="font-weight:800">Tips</div>
        <div class="footer-note">Continuous: live tracking. Tap image/video to pick center pixel. Works on phones & laptops.</div>
      </div>
    </div>
  </div>
</div>

<script>
const COLORS = [
  ["Red",255,0,0,"#FF0000"],["Green",0,255,0,"#00FF00"],["Blue",0,0,255,"#0000FF"],
  ["Black",0,0,0,"#000000"],["White",255,255,255,"#FFFFFF"],["Yellow",255,255,0,"#FFFF00"],
  ["Cyan",0,255,255,"#00FFFF"],["Magenta",255,0,255,"#FF00FF"],["Orange",255,165,0,"#FFA500"]
];

const startStopBtn = document.getElementById('startStopBtn');
const detectNowBtn = document.getElementById('detectNowBtn');
const uploadInput = document.getElementById('uploadInput');
const continuousToggle = document.getElementById('continuousToggle');

const video = document.getElementById('video');
const previewImg = document.getElementById('previewImg');
const buffer = document.getElementById('buffer');
const magnCanvas = document.getElementById('magnCanvas');
const magnifier = document.getElementById('magnifier');

const floatingChip = document.getElementById('floatingChip');
const chipSwatch = document.getElementById('chipSwatch');
const chipName = document.getElementById('chipName');
const chipMeta = document.getElementById('chipMeta');

const bigSwatch = document.getElementById('bigSwatch');
const colorNameEl = document.getElementById('colorName');
const colorSubEl = document.getElementById('colorSub');
const hexLabel = document.getElementById('hexLabel');
const copyHexBtn = document.getElementById('copyHex');
const exportBtn = document.getElementById('exportHistory');
const clearHistoryBtn = document.getElementById('clearHistory');
const historyList = document.getElementById('historyList');

const stageBody = document.getElementById('stageBody');
const bufferCtx = buffer.getContext('2d');
const magnCtx = magnCanvas.getContext('2d');

let stream=null, anim=null, history=[];

// helpers
function rgbToHex(r,g,b){ return "#"+[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('').toUpperCase();}
function clamp(v){ return Math.max(0,Math.min(255,Math.round(v))); }
function findClosestColor(r,g,b){
  let best={d:Infinity,idx:0};
  for(let i=0;i<COLORS.length;i++){
    const c=COLORS[i];
    const d=(c[1]-r)**2 + (c[2]-g)**2 + (c[3]-b)**2;
    if(d<best.d){best.d=d;best.idx=i;}
  }
  const c=COLORS[best.idx];
  return {name:c[0],r:c[1],g:c[2],b:c[3],hex:c[4]};
}
function updateDisplay(r,g,b){
  const hex=rgbToHex(r,g,b);
  const found=findClosestColor(r,g,b);
  colorNameEl.textContent=found.name;
  colorSubEl.textContent=`RGB (${r},${g},${b}) · HEX ${hex}`;
  hexLabel.textContent=hex;
  bigSwatch.style.background=`rgb(${r},${g},${b})`;
  chipSwatch.style.background=`rgb(${r},${g},${b})`;
  chipName.textContent=found.name;
  chipMeta.textContent=`RGB (${r},${g},${b}) · ${hex}`;
  pushHistory(found.name,r,g,b,hex);
  showFloating();
}
function pushHistory(name,r,g,b,hex){
  history.unshift({name,r,g,b,hex,time:new Date().toLocaleTimeString()});
  if(history.length>12) history.length=12;
  renderHistory();
}
function renderHistory(){
  historyList.innerHTML='';
  history.forEach((h,i)=>{
    const item=document.createElement('div');
    item.className='history-item';
    item.innerHTML=`<div class="hist-swatch" style="background:${h.hex}"></div>
    <div class="hist-meta"><div class="hist-name">${h.name}</div><div class="hist-sub">${h.hex} · ${h.time}</div></div>
    <button class="copy-small" data-idx="${i}">Copy</button>`;
    item.addEventListener('click',()=>updateDisplay(h.r,h.g,h.b));
    item.querySelector('button.copy-small').addEventListener('click',ev=>{
      ev.stopPropagation();
      navigator.clipboard.writeText(h.hex).then(()=>{ev.target.textContent='Copied'; setTimeout(()=>ev.target.textContent='Copy',800)});
    });
    historyList.appendChild(item);
  });
}

function showFloating(){ floatingChip.classList.remove('hidden'); setTimeout(()=>floatingChip.classList.add('hidden'),3000); }

function detectCenter(){
  let w,h;
  buffer.width=video.videoWidth||previewImg.naturalWidth;
  buffer.height=video.videoHeight||previewImg.naturalHeight;
  w=buffer.width; h=buffer.height;
  bufferCtx.clearRect(0,0,w,h);
  if(video.style.display!=='none') bufferCtx.drawImage(video,0,0,w,h);
  else if(previewImg.style.display!=='none') bufferCtx.drawImage(previewImg,0,0,w,h);
  const x=Math.floor(w/2), y=Math.floor(h/2);
  const p=bufferCtx.getImageData(x,y,1,1).data;
  updateDisplay(p[0],p[1],p[2]);
  drawMagnifier(x,y);
}
function drawMagnifier(cx,cy){
  magnifier.style.display='block';
  const magSize=120,zoom=6;
  magnCanvas.width=magnCanvas.height=magSize;
  magnCtx.clearRect(0,0,magSize,magSize);
  magnCtx.imageSmoothingEnabled=false;
  magnCtx.drawImage(buffer,cx-10,cy-10,20,20,0,0,magSize,magSize);
}

function startCamera(){
  if(stream){ stopCamera(); return;}
  navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}}).then(s=>{
    stream=s;
    video.srcObject=s;
    video.style.display='block';
    previewImg.style.display='none';
    startStopBtn.textContent='Stop Camera';
    anim=requestAnimationFrame(loop);
  }).catch(console.error);
}
function stopCamera(){
  if(stream){stream.getTracks().forEach(t=>t.stop()); stream=null;}
  video.style.display='none';
  startStopBtn.textContent='Start Camera';
  cancelAnimationFrame(anim);
  magnifier.style.display='none';
}

function loop(){
  if(continuousToggle.checked) detectCenter();
  anim=requestAnimationFrame(loop);
}

startStopBtn.addEventListener('click',startCamera);
detectNowBtn.addEventListener('click',detectCenter);
continuousToggle.addEventListener('change',()=>{if(continuousToggle.checked) anim=requestAnimationFrame(loop); else cancelAnimationFrame(anim);});

uploadInput.addEventListener('change',ev=>{
  stopCamera();
  const file=ev.target.files[0];
  if(file){
    previewImg.src=URL.createObjectURL(file);
    previewImg.style.display='block';
  }
});

copyHexBtn.addEventListener('click',()=>navigator.clipboard.writeText(hexLabel.textContent));
exportBtn.addEventListener('click',()=>{const text=history.map(h=>`${h.time}: ${h.name} ${h.hex}`).join('\n');navigator.clipboard.writeText(text)});
clearHistoryBtn.addEventListener('click',()=>{history=[];renderHistory();});
</script>
</body>
</html>
