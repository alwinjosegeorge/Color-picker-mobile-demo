<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TrueShade Pro — Color Detector</title>
<style>
:root{
  --bg:#f3f4f6; --card-bg:#ffffff; --primary:#5b21b6; --secondary:#7c3aed; --text:#111827;
  --muted:#6b7280; --radius:12px; --btn-padding:14px 22px;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter, sans-serif;}
body{background:var(--bg);display:flex;justify-content:center;padding:20px;color:var(--text);}
.app{width:960px;max-width:95vw;background:var(--card-bg);border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,0.1);overflow:hidden;}
.header{padding:20px;text-align:center;}
.header h1{color:var(--primary);font-size:28px;}
.header p{color:var(--muted);margin-top:4px;}
.main{display:flex;gap:20px;padding:20px;flex-wrap:wrap;}
.stage, .panel{flex:1;min-width:300px;background:#f9fafb;border-radius:var(--radius);padding:16px;box-shadow:0 4px 20px rgba(0,0,0,0.05);}
.video-section, .upload-section{margin-bottom:16px;text-align:center;}
video, img{width:100%;border-radius:var(--radius);border:1px solid #e5e7eb;}
button{padding:var(--btn-padding);border:none;border-radius:var(--radius);cursor:pointer;font-weight:600;font-size:16px;transition:0.15s;}
button.primary{background:var(--primary);color:#fff;margin:6px;}
button.secondary{background:var(--secondary);color:#fff;margin:6px;}
button:hover{opacity:.9;transform:translateY(-1px);}
.panel h2{margin-bottom:12px;color:var(--primary);}
.color-display{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
.swatch{width:60px;height:60px;border-radius:var(--radius);border:1px solid #e5e7eb;}
.color-info{flex:1;}
.color-info p{margin-bottom:4px;color:var(--text);}
#hexLabel{font-weight:700;}
.history{max-height:250px;overflow-y:auto;margin-top:12px;}
.history-item{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:var(--radius);background:#f3f4f6;margin-bottom:6px;cursor:pointer;}
.hist-swatch{width:36px;height:36px;border-radius:var(--radius);border:1px solid #e5e7eb;}
.hist-meta{flex:1;font-size:14px;color:var(--text);}
input[type=file]{display:none;}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <h1>TrueShade Pro</h1>
    <p>Professional color detection — Camera or Upload</p>
  </div>
  <div class="main">
    <div class="stage">
      <h2>Camera Detection</h2>
      <div class="video-section">
        <video id="video" autoplay muted playsinline style="display:none"></video>
        <canvas id="canvas" style="display:none"></canvas>
      </div>
      <div style="text-align:center;">
        <button class="primary" id="startStopBtn">Start Camera</button>
        <button class="secondary" id="detectNowBtn">Detect Now</button>
      </div>
      <h2>Upload Image</h2>
      <div class="upload-section">
        <label for="uploadInput">
          <button class="primary">Upload Image</button>
        </label>
        <input id="uploadInput" type="file" accept="image/*">
        <img id="previewImg" alt="Preview" style="display:none;margin-top:10px;">
      </div>
    </div>
    <div class="panel">
      <h2>Detected Color</h2>
      <div class="color-display">
        <div class="swatch" id="bigSwatch"></div>
        <div class="color-info">
          <p id="colorName">—</p>
          <p id="colorSub">—</p>
          <p>HEX: <span id="hexLabel">—</span></p>
          <button class="secondary" id="copyHex">Copy HEX</button>
        </div>
      </div>
      <h2>History</h2>
      <div class="history" id="historyList"></div>
      <button class="secondary" id="clearHistory">Clear History</button>
    </div>
  </div>
</div>

<script>
// Elements
let video=document.getElementById('video'), canvas=document.getElementById('canvas'), ctx=canvas.getContext('2d');
let previewImg=document.getElementById('previewImg'), bigSwatch=document.getElementById('bigSwatch');
let colorNameEl=document.getElementById('colorName'), colorSubEl=document.getElementById('colorSub'), hexLabel=document.getElementById('hexLabel');
let historyList=document.getElementById('historyList');
let history=[];

// Simple demo colors
const colors=[{name:"Red",r:255,g:0,b:0},{name:"Green",r:0,g:255,b:0},{name:"Blue",r:0,g:0,b:255},{name:"White",r:255,g:255,b:255},{name:"Black",r:0,g:0,b:0},{name:"Yellow",r:255,g:255,b:0},{name:"Cyan",r:0,g:255,b:255},{name:"Magenta",r:255,g:0,b:255}];

// Utils
function rgbToHex(r,g,b){return"#"+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1).toUpperCase();}
function findClosestColor(r,g,b){let minDist=1e9, nearest=colors[0];colors.forEach(c=>{let d=Math.sqrt((r-c.r)**2+(g-c.g)**2+(b-c.b)**2);if(d<minDist){minDist=d;nearest=c;}});return nearest;}
function updateDisplay(r,g,b){const hex=rgbToHex(r,g,b);const found=findClosestColor(r,g,b);colorNameEl.textContent=found.name;colorSubEl.textContent=`RGB(${r},${g},${b})`;hexLabel.textContent=hex;bigSwatch.style.background=`rgb(${r},${g},${b})`;pushHistory(found.name,r,g,b,hex);}
function pushHistory(name,r,g,b,hex){history.unshift({name,r,g,b,hex});if(history.length>12) history.pop();renderHistory();}
function renderHistory(){historyList.innerHTML='';history.forEach(h=>{let div=document.createElement('div');div.className='history-item';div.innerHTML=`<div class="hist-swatch" style="background:rgb(${h.r},${h.g},${h.b})"></div><div class="hist-meta">${h.name} - ${h.hex}</div>`;div.onclick=()=>updateDisplay(h.r,h.g,h.b);historyList.appendChild(div);});}

// Camera
let stream=null, running=false;
document.getElementById('startStopBtn').onclick=async()=>{
  if(!running){
    try{stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});video.srcObject=stream;video.style.display="block";previewImg.style.display="none";running=true;document.getElementById('startStopBtn').textContent="Stop Camera";requestAnimationFrame(updateFrame);}catch(e){alert("Camera not accessible")}
  }else{
    stream.getTracks().forEach(t=>t.stop());video.style.display="none";running=false;document.getElementById('startStopBtn').textContent="Start Camera";
  }
}
function updateFrame(){
  if(running){canvas.width=video.videoWidth;canvas.height=video.videoHeight;ctx.drawImage(video,0,0);let x=Math.floor(video.videoWidth/2),y=Math.floor(video.videoHeight/2);let p=ctx.getImageData(x,y,1,1).data;updateDisplay(p[0],p[1],p[2]);requestAnimationFrame(updateFrame);}}

document.getElementById('detectNowBtn').onclick=()=>{
  if(running){let x=Math.floor(video.videoWidth/2),y=Math.floor(video.videoHeight/2);let p=ctx.getImageData(x,y,1,1).data;updateDisplay(p[0],p[1],p[2]);}
}

document.getElementById('uploadInput').onchange=e=>{
  let file=e.target.files[0]; if(!file)return;
  let url=URL.createObjectURL(file);previewImg.src=url;previewImg.style.display="block";video.style.display="none";
  let img=new Image();img.src=url;img.onload=()=>{canvas.width=img.width;canvas.height=img.height;ctx.drawImage(img,0,0);let x=Math.floor(img.width/2),y=Math.floor(img.height/2);let p=ctx.getImageData(x,y,1,1).data;updateDisplay(p[0],p[1],p[2]);}}
document.getElementById('copyHex').onclick=()=>{navigator.clipboard.writeText(hexLabel.textContent).then(()=>alert("HEX copied"))}
document.getElementById('clearHistory').onclick=()=>{history=[];renderHistory();}
</script>
</body>
</html>
